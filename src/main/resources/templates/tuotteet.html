<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Tuotteet</title>
    <link rel="stylesheet" type="text/css" href="./styles.css" />
    <style>
      .asc::after {
        content: " ▲";
      }

      .desc::after {
        content: " ▼";
      }
    </style>
    <script>
      function sortTable(columnIndex) {
        var table,
          rows,
          switching,
          i,
          x,
          y,
          shouldSwitch,
          dir,
          switchcount = 0;
        table = document.querySelector("table");
        switching = true;
        dir = "asc";
        while (switching) {
          switching = false;
          rows = table.rows;
          for (i = 1; i < rows.length - 1; i++) {
            shouldSwitch = false;
            x = rows[i].getElementsByTagName("TD")[columnIndex];
            y = rows[i + 1].getElementsByTagName("TD")[columnIndex];
            if (dir == "asc") {
              if (isNaN(x.innerHTML)) {
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
                  break;
                }
              } else {
                if (Number(x.innerHTML) > Number(y.innerHTML)) {
                  shouldSwitch = true;
                  break;
                }
              }
            } else if (dir == "desc") {
              if (isNaN(x.innerHTML)) {
                if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
                  break;
                }
              } else {
                if (Number(x.innerHTML) < Number(y.innerHTML)) {
                  shouldSwitch = true;
                  break;
                }
              }
            }
          }
          if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
            switchcount++;
          } else {
            if (switchcount == 0 && dir == "asc") {
              dir = "desc";
              switching = true;
            }
          }
        }
        toggleSortIcon(columnIndex, dir);
      }

      function toggleSortIcon(columnIndex, dir) {
        var th = document.querySelectorAll("th");
        th.forEach(function (el) {
          el.classList.remove("asc", "desc");
        });
        if (dir == "asc") {
          th[columnIndex].classList.remove("desc");
          th[columnIndex].classList.add("asc");
        } else if (dir == "desc") {
          th[columnIndex].classList.remove("asc");
          th[columnIndex].classList.add("desc");
        }
      }
    </script>
  </head>
  <body>
    <div>
      <h1>Tuotteet</h1>
      <nav>
        <ul>
          <li><a href="/">Etusivu</a></li>
          <li><a href="/osastot">Osastot</a></li>
          <li><a href="/kahvilaitteet">Kahvilaitteet</a></li>
          <li><a href="/kulutustuotteet">Kulutustuotteet</a></li>
        </ul>
      </nav>
    </div>
    <h2>Lisää uusi tuote</h2>
    <!-- Form for adding a new product -->
    <div>
      <h2>Tuotteet</h2>
      <table>
        <thead>
          <tr>
            <!-- Table headers with sorting onclick event -->
            <th onclick="sortTable(0)">ID</th>
            <th onclick="sortTable(1)">Nimi</th>
            <th onclick="sortTable(2)">Kuvaus</th>
            <th onclick="sortTable(3)">Hinta</th>
            <th onclick="sortTable(4)">Toimittaja</th>
            <th onclick="sortTable(5)">Valmistaja</th>
            <th onclick="sortTable(6)">Osasto</th>
            <th>Toiminnot</th>
          </tr>
        </thead>
        <tbody>
          <!-- Iterate over the list of products and display them in table rows -->
          <tr th:each="tuote : ${tuotteet}">
            <td th:text="${tuote.id}"></td>
            <td th:text="${tuote.nimi}"></td>
            <td th:text="${tuote.kuvaus}"></td>
            <td th:text="${tuote.hinta}"></td>
            <td th:text="${tuote.toimittaja.nimi}"></td>
            <td th:text="${tuote.valmistaja.nimi}"></td>
            <td th:text="${tuote.osasto.nimi}"></td>
            <td>
              <!-- Delete button with confirmation -->
              <form
                th:action="@{/poista-tuote/{id}(id=${tuote.id})}"
                method="post"
                onsubmit="return confirmDelete()"
              >
                <input type="hidden" name="tuoteId" th:value="${tuote.id}" />
                <input type="submit" value="Poista" />
              </form>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>
</html>
